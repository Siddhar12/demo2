<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Google Sign-In</title>
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js">
         const supabaseUrl = 'https://hjionmetmiphksnptsso.supabase.co';
        const supabaseAnonKey = 'eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJzdXBhYmFzZSIsInJlZiI6ImhqaW9ubWV0bWlwaGtzbnB0c3NvIiwicm9sZSI6ImFub24iLCJpYXQiOjE3Mzk4OTIwMjEsImV4cCI6MjA1NTQ2ODAyMX0.-svmO28RlTGJM8iB52wn-MXSAWsUoQeLO5fkERHlWPs';
        const supabase = supabase.createClient(supabaseUrl, supabaseAnonKey);
    </script>
</head>
<body>
    <button id="googleSignInButton">
        Sign in with Google
    </button>

    <script type="module">
        // Firebase Imports
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-app.js";
import { getAuth, signInWithRedirect, getRedirectResult, GoogleAuthProvider } from "https://www.gstatic.com/firebasejs/9.6.1/firebase-auth.js";
import { createClient } from "https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2.0.0/+esm";

const firebaseConfig = {
            apiKey: "AIzaSyAmQVUMKfy-u57SUB8_ysO-tpJ8cRTSnxw",
            authDomain: "avionai-78e83.firebaseapp.com",
            projectId: "avionai-78e83",
            storageBucket: "avionai-78e83.firebasestorage.app",
            messagingSenderId: "312505114643",
            appId: "1:312505114643:web:931ccb4217f42a39cf9fe6",
            measurementId: "G-QBYM2YYLY1"
        };
// Initialize Firebase
const app = initializeApp(firebaseConfig);
const auth = getAuth(app);
const provider = new GoogleAuthProvider();

// Supabase Configuration

// üîπ Google Sign-In Function
async function googleSignIn() {
    try {
        console.log("Redirecting to Google Sign-In...");
        await signInWithRedirect(auth, provider);
    } catch (error) {
        console.error("Google Sign-In Error:", error);
    }
}

// üîπ Handle Redirect Result (After Login)
async function handleRedirectResult() {
    try {
        const result = await getRedirectResult(auth);
        if (!result || !result.user) {
            console.warn("No user found after redirect.");
            return;
        }

        const user = result.user;
        console.log("‚úÖ Google Sign-In Success:", user);

        // Save user to Supabase
        const { data, error } = await supabase
            .from('profiles')
            .upsert({
                id: user.uid,
                username: user.displayName,
                email: user.email,
                created_at: new Date().toISOString()
            })
            .select();

        if (error) {
            console.error("‚ùå Supabase Save Error:", error);
            return;
        }

        console.log("‚úÖ User saved successfully:", data);
        window.location.href = "https://avion-ai.vercel.app/#";
    } catch (error) {
        console.error("‚ùå Redirect Result Error:", error);
    }
}

// üîπ Auto-run when page loads (check redirect result)
document.addEventListener("DOMContentLoaded", () => {
    console.log("üìå Checking Google Sign-In redirect result...");
    handleRedirectResult();

    // Ensure the button exists before adding event listener
    const googleSignInBtn = document.getElementById("googleSignInBtn");
    if (googleSignInBtn) {
        googleSignInBtn.addEventListener("click", googleSignIn);
    } else {
        console.error("‚ùå googleSignInBtn not found in the DOM.");
    }
});

// üîπ Attach Google Sign-In Button
document.getElementById("googleSignInBtn").addEventListener("click", googleSignIn);

        // Check for redirect result when page loads
        handleRedirectResult();
    </script>
</body>
</html>
